<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-7BJS149EFL"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-7BJS149EFL');
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Portfolio of Álvaro Menéndez Ros's projects in Data Science, AI, and Web Development">
    <title>Projects - Álvaro Menéndez Ros</title>
    <link rel="icon" href="./assets/svg/favicon.svg" type="image/svg+xml">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="menu-overlay"></div>
    <header>
        <nav class="nav-container">
            <div class="hamburger" id="hamburger">
                <span></span>
                <span></span>
                <span></span>
            </div>
            <ul class="nav-links" id="navLinks">
                <li><a href="./index.html">About</a></li>
                <li><a href="./journey.html">My Life</a></li>
                <li><a href="./projects.html">Projects</a></li>
                <li><a href="./blogs.html">Blog</a></li>
                <li><a href="./notes.html">MSc AIES</a></li>
                <li><a href="./calendar.html">Calendar</a></li>
                <li><a href="https://dailyclips.es/" target="_blank">Daily Clips</a></li>
                <li><a href="https://alvaromenendez.es/ufc-predictions/" target="_blank">UFC Predictions</a></li>
                <li><a href="./acknowledgments.html">Acknowledgments</a></li>
                <li><a href="./assets/Alvaro_Menendez_CV.pdf" download>CV</a></li>
            </ul>
            <div class="nav-right">
                <div class="social-links">
                    <a href="https://github.com/DKeAlvaro" target="_blank" aria-label="GitHub">
                        <img src="assets/svg/github.svg" alt="GitHub" class="social-icon">
                    </a>
                    <a href="https://www.linkedin.com/in/alvaromenendezros" target="_blank" aria-label="LinkedIn">
                        <img src="assets/svg/linkedin.svg" alt="LinkedIn" class="social-icon">
                    </a>
                    <a href="mailto:alvaro.mrgr@gmail.com" aria-label="Email">
                        <img src="assets/svg/gmail.svg" alt="Email" class="social-icon">
                    </a>
                </div>
                <div class="theme-toggle" id="themeToggle" aria-label="Toggle theme" role="button" tabindex="0"><img src="assets/svg/sun.svg" alt="Toggle theme" class="theme-icon"></div>
            </div>
        </nav>
    </header>

    <div class="page-container">
        <div class="content">
            <div class="projects-overview-container" id="projects-overview-container">
                <div class="loading-indicator">
                    <p>Loading projects...</p>
                </div>
            </div>
        </div>
    </div>
    
    <footer>
        <p id="footerYear"></p>
    </footer>
    
    <script src="./script.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const username = 'DKeAlvaro';
            const overviewContainer = document.getElementById('projects-overview-container');

            function loadProjects() {
                overviewContainer.innerHTML = '<div class="loading-indicator"><p>Loading projects...</p></div>';
                fetch(`https://api.github.com/users/${username}/repos?per_page=100`)
                    .then(response => {
                        if (!response.ok) throw new Error('Network response was not ok');
                        return response.json();
                    })
                    .then(repos => {
                        const eligibleRepos = repos.filter(r => !r.fork && r.stargazers_count > 0)
                                                   .sort((a, b) => b.stargazers_count - a.stargazers_count);
                        
                        if (eligibleRepos.length === 0) {
                            overviewContainer.innerHTML = '<p>No repositories with stars found.</p>';
                            return;
                        }

                        overviewContainer.innerHTML = ''; // Clear loading message
                        eligibleRepos.forEach(repo => {
                            displayProjectWithReadme(repo);
                        });
                    })
                    .catch(error => {
                        overviewContainer.innerHTML = `<div class="error-message"><p>Failed to load projects. Please try again later.</p><p>Error: ${error.message}</p></div>`;
                    });
            }

            function displayProjectWithReadme(repo) {
                const projectContainer = document.createElement('div');
                projectContainer.className = 'project-card collapsed';
                
                const readmeContainerId = `readme-${repo.id}`;
                projectContainer.innerHTML = `
                    <div class="project-header">
                        <div class="project-title-area" id="title-area-${repo.id}">
                            <h3>${repo.name}</h3>
                            <span class="collapse-icon"></span>
                        </div>
                        <div class="project-subheader">
                            <p>${repo.description || 'No description available.'}</p>
                            <div class="project-meta">
                                <span><svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" class="star-icon">
                                    <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                                </svg> ${repo.stargazers_count}</span>
                                <a href="${repo.html_url}" target="_blank" rel="noopener noreferrer" class="repo-link">View on GitHub</a>
                            </div>
                        </div>
                    </div>
                    <div class="project-readme" id="${readmeContainerId}">
                        <div class="loading-indicator"><p>Loading README...</p></div>
                    </div>
                `;
                overviewContainer.appendChild(projectContainer);

                const header = projectContainer.querySelector('.project-header');
                header.addEventListener('click', () => {
                    projectContainer.classList.toggle('collapsed');
                });

                const readmeContainer = document.getElementById(readmeContainerId);
                fetchReadmeAndRender(repo, readmeContainer);
            }

            function fetchReadmeAndRender(repo, targetContainer) {
                const tryBranches = ['main', 'master'];
                const readmeFiles = ['README.md', 'readme.md'];
                let branchIndex = 0;
                let readmeIndex = 0;

                function tryFetch() {
                    if (branchIndex >= tryBranches.length) {
                        targetContainer.innerHTML = '<div class="error-message"><p>README not found for this project.</p></div>';
                        return;
                    }

                    const branch = tryBranches[branchIndex];
                    const readmeFile = readmeFiles[readmeIndex];
                    const readmeUrl = `https://raw.githubusercontent.com/${repo.owner.login}/${repo.name}/${branch}/${readmeFile}`;

                    fetch(readmeUrl)
                        .then(r => {
                            if (!r.ok) throw new Error('Not found');
                            return r.text();
                        })
                        .then(md => {
                            renderReadme(repo, md, branch, targetContainer);
                        })
                        .catch(error => {
                            readmeIndex++;
                            if (readmeIndex >= readmeFiles.length) {
                                readmeIndex = 0;
                                branchIndex++;
                            }
                            tryFetch();
                        });
                }
                tryFetch();
            }

            function renderReadme(repo, md, branch, targetContainer) {
                // Find and insert project image from README
                try {
                    const markdownImageRegex = /!\[.*?\]\((.*?)\)/;
                    const htmlImageRegex = /<img[^>]+src=["']([^"']+)["']/;
                    const mdMatch = (md || '').match(markdownImageRegex);
                    const htmlMatch = (md || '').match(htmlImageRegex);

                    let imageUrl = null;
                    if (mdMatch && mdMatch[1]) {
                        imageUrl = mdMatch[1];
                    } else if (htmlMatch && htmlMatch[1]) {
                        imageUrl = htmlMatch[1];
                    }

                    if (imageUrl) {
                        const rawBase = `https://raw.githubusercontent.com/${repo.owner.login}/${repo.name}/${branch}/`;
                        let absImageUrl = imageUrl.match(/^https?:\/\//) ? imageUrl : rawBase + imageUrl.replace(/^\.?\/?/, '');

                        const titleArea = document.getElementById(`title-area-${repo.id}`);
                        if (titleArea && !titleArea.querySelector('.project-image')) {
                            const projectImage = document.createElement('img');
                            projectImage.src = absImageUrl;
                            projectImage.className = 'project-image';
                            const titleH3 = titleArea.querySelector('h3');
                            if (titleH3) {
                                titleArea.insertBefore(projectImage, titleH3);
                            } else {
                                titleArea.prepend(projectImage);
                            }
                        }
                    }
                } catch(e) { console.error("Error finding project image:", e); }

                targetContainer.innerHTML = ''; // Clear loading indicator

                const rawBase = `https://raw.githubusercontent.com/${repo.owner.login}/${repo.name}/${branch}/`;
                let html = marked.parse(md || '');
                
                // Fix relative image/video links
                html = html.replace(/<img([^>]+)src=["']([^"']+)["']/g, (match, pre, src) => {
                    let abs = src.match(/^https?:\/\//) ? src : rawBase + src.replace(/^\.?\/?/, '');
                    return `<img${pre}src="${abs}"`;
                });
                html = html.replace(/<video([^>]+)src=["']([^"']+)["']/g, (match, pre, src) => {
                    let abs = src.match(/^https?:\/\//) ? src : rawBase + src.replace(/^\.?\/?/, '');
                    return `<video${pre}src="${abs}"`;
                });
                
                // Embed GitHub user-attachments links as <video> or <img>
                html = html.replace(/<a[^>]+href=["'](https:\/\/github.com\/user-attachments\/assets\/[^"']+)["'][^>]*>([^<]*)<\/a>/gi, function(match, url, filename) {
                    const videoExt = /(\.mp4|\.webm|\.ogg)$/i;
                    const imageExt = /(\.png|\.jpg|\.jpeg|\.gif|\.bmp|\.svg)$/i;
                    if (videoExt.test(url) || videoExt.test(filename)) {
                        return `<video controls style="max-width:100%;height:auto;"><source src="${url}" type="video/mp4">Your browser does not support the video tag.</video>`;
                    } else if (imageExt.test(url) || imageExt.test(filename)) {
                        return `<img src="${url}" alt="${filename}" style="max-width:100%;height:auto;" />`;
                    } else {
                        if (/\/assets\/[a-f0-9\-]+$/.test(url)) {
                           return `<video controls style="max-width:100%;height:auto;"><source src="${url}" type="video/mp4">Your browser does not support the video tag.</video>`;
                        }
                        return match;
                    }
                });
                
                targetContainer.innerHTML = `<div class="readme-content">${html}</div>`;
            }

            loadProjects();
        });
    </script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
    .projects-overview-container {
        display: flex;
        flex-direction: column;
        gap: 40px; /* Increased separation */
    }
    .project-card {
        border: none;
        padding: 20px;
        border-radius: 8px;
        background-color: var(--background-color, #fff);
        box-shadow: 0 4px 12px rgba(0,0,0,0.1); /* Enhanced shadow for better separation */
        overflow: hidden; /* To contain readme content */
        transition: all 0.3s ease-in-out;
    }
    .project-header {
        cursor: pointer;
        padding: 10px;
        border-radius: 6px;
        transition: background-color 0.2s ease-in-out;
    }
    .project-header:hover {
        background-color: var(--hover-bg, #f0f0f0);
    }
    .project-title-area {
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    .project-image {
        width: 60px;
        height: 60px;
        border-radius: 6px;
        margin-right: 15px;
        object-fit: contain;
    }
    .collapse-icon {
        width: 16px;
        height: 16px;
        border-right: 2px solid var(--accent-color);
        border-bottom: 2px solid var(--accent-color);
        transform: rotate(45deg);
        transition: transform 0.3s ease-in-out;
    }
    .project-card.collapsed .collapse-icon {
        transform: rotate(-45deg);
    }
    .project-subheader {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-top: 5px;
    }
    .project-card h3 {
        margin-top: 0;
        color: var(--accent-color, #333);
        font-size: 2.2em;
        margin-bottom: 0;
    }
    .project-header p {
        font-style: italic;
        font-size: 1rem;
        opacity: 0.8;
        color: var(--text-color, #555);
        margin-bottom: 0;
        margin-right: 20px;
    }
    .project-meta {
        display: flex;
        align-items: center;
        gap: 15px;
        font-size: 0.9rem;
        white-space: nowrap;
    }
    .project-meta .repo-link {
        color: var(--accent-color, #007bff);
        text-decoration: none;
    }
    .project-meta .repo-link:hover {
        text-decoration: underline;
    }
    .project-readme {
        margin-top: 15px;
        border-top: none; /* Removed horizontal line */
        padding-top: 0;
        max-height: 2000px; /* Adjust as needed, for transition */
        overflow: hidden;
        transition: max-height 0.5s ease-in-out, margin-top 0.5s ease-in-out, opacity 0.3s ease-in-out;
        opacity: 1;
    }
    .project-card.collapsed .project-readme {
        max-height: 0;
        margin-top: 0;
        opacity: 0;
    }
    .project-readme img,
    .project-readme video {
        max-width: 80%;
        height: auto;
        border-radius: 4px;
        margin-top: 10px;
        margin-bottom: 10px;
        display: block;
        margin-left: auto;
        margin-right: auto;
    }
    .readme-content {
        line-height: 1.6;
    }
    .readme-content hr {
        display: none; /* Removed horizontal lines from READMEs */
    }
    .readme-content h1,
    .readme-content h2,
    .readme-content h3,
    .readme-content h4,
    .readme-content h5,
    .readme-content h6 {
        margin-top: 24px;
        margin-bottom: 16px;
        font-weight: 600;
        line-height: 1.25;
        color: var(--accent-color);
        border-bottom: none;
        padding-bottom: 0;
    }
    .readme-content h1 {
        font-size: 1.8em;
        border-bottom: 2px solid var(--border-color, #eee);
        padding-bottom: .3em;
    }
    .readme-content h2 {
        font-size: 1.5em;
        border-bottom: 1px solid var(--border-color, #eee);
        padding-bottom: .3em;
    }
    .readme-content h3 { font-size: 1.2em; font-weight: bold; }
    .readme-content p {
        margin-bottom: 16px;
    }
    .readme-content ul,
    .readme-content ol {
        padding-left: 20px;
        margin-bottom: 16px;
    }
    .readme-content li {
        margin-bottom: 8px;
    }
    .readme-content pre {
        background-color: var(--code-bg, #f6f8fa);
        border-radius: 6px;
        padding: 16px;
        overflow: auto;
        line-height: 1.45;
    }
    .readme-content code {
        background-color: var(--code-bg, #f6f8fa);
        border-radius: 6px;
        padding: .2em .4em;
        margin: 0;
        font-size: 85%;
    }
    .readme-content pre code {
        padding: 0;
        margin: 0;
        font-size: 100%;
        background-color: transparent;
        border: none;
    }
    .readme-content blockquote {
        padding: 0 1em;
        color: var(--text-color, #555);
        border-left: .25em solid var(--border-color, #dfe2e5);
        margin-left: 0;
        margin-right: 0;
        margin-bottom: 16px;
    }
    .readme-content table {
        border-collapse: collapse;
        width: 100%;
        margin-bottom: 16px;
    }
    .readme-content th,
    .readme-content td {
        border: 1px solid var(--border-color, #dfe2e5);
        padding: 8px 12px;
    }
    .readme-content th {
        font-weight: 600;
        background-color: var(--table-header-bg, #f6f8fa);
    }
    .loading-indicator,
    .error-message {
        padding: 20px;
        text-align: center;
        border-radius: 8px;
        margin: 20px 0;
    }
    .loading-indicator p {
        font-size: 1.1rem;
        color: var(--text-color, #555);
    }
    .error-message {
        background-color: var(--error-bg, #ffebee);
        color: var(--error-text, #c62828);
        border: 1px solid var(--error-border, #c62828);
    }
    .error-message p {
        margin: 5px 0;
    }

    @media (max-width: 768px) {
        .project-card {
            padding: 15px;
        }

        .project-card h3 {
            font-size: 1.8em;
        }
        
        .project-image {
            width: 40px;
            height: 40px;
        }
        
        .project-subheader {
            flex-direction: column;
            align-items: flex-start;
            gap: 10px;
        }

        .project-header p {
            font-size: 0.9rem;
            margin-right: 0;
        }

        .project-meta {
            white-space: normal;
            font-size: 0.8rem;
        }
        
        .readme-content h1 { font-size: 1.6em; }
        .readme-content h2 { font-size: 1.3em; }
        .readme-content h3 { font-size: 1.1em; }
        
        .project-readme img,
        .project-readme video {
            max-width: 100%;
        }
    }
    </style>
</body>
</html>

